---
title: "crsim: vignette"
author: "Andrew D. Letten"
output: rmarkdown::html_document
vignette: >
  %\VignetteIndexEntry{crsim, how to...}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

`crsim` is an R package for defining ode models of consumer-resource interactions for use alongside `deSolve`. It also provides a number of additional functions for visualising functional responses and output dynamics from `deSolve`.

```{r setup}
library(crsim)
library(deSolve)

```

The main user function in `crsim` is `make_par_list()`. This is where you define the structure and parameterisation of the model.

```{r}
pars <- make_par_list(
  spnum = 2, 
  resnum = 2,
  linear = FALSE,
  mumatrix = list(matrix(c(0.7, 0.17, 
                      0.2, 0.6), 
                    nrow = 2, 
                    ncol = 2,
                    byrow = TRUE)),
  kmatrix = matrix(c(1, 0.075, 
                     0.1, 1), 
                   nrow = 2, 
                   ncol = 2, 
                   byrow = TRUE),
  essential = FALSE, 
  chemo = TRUE,
  resspeed = 1,
  resconc = 0.6,
  respulse = 0,
  mort = 0.1,
  timepars = FALSE,
  timeswitch = 96,
  timeswitch_length = 1000
)
```

```{r}
plot_funcresp(pars, maxx = 0.6)
```

```{r}
happenings <- time_vals(total = 1000)

testrun.df <- ode(
  func = def_cr_ode,
  y = initiate_state(vars=pars),
  parms = pars,
  times = happenings$totaltime,
  method = "lsoda"
  )

plot_crsim(testrun.df, pars) 
```

Now with a single pulsing resource...

```{r}
pars <- make_par_list(
  spnum = 2, 
  resnum = 1,
  linear = FALSE,
  mumatrix = list(matrix(c(0.7, 0.15), 
                    nrow = 2, 
                    ncol = 1,
                    byrow = TRUE)),
  kmatrix = matrix(c(1, 0.02), 
                   nrow = 2, 
                   ncol = 1, 
                   byrow = TRUE),
  essential = FALSE, 
  chemo = TRUE,
  resspeed = 0,
  resconc = 0.6,
  respulse = 0.75,
  mort = 0.1,
  timepars = FALSE,
  timeswitch = 0,
  timeswitch_length = 1000
)
```
```{r}
happenings <- time_vals(total = 1000, pulse = 10)

testrun.df <- ode(
  func = def_cr_ode,
  y = initiate_state(vars=pars),
  parms = pars,
  times = happenings$totaltime,
  method = "lsoda",
  events = list(func = eventfun_respulse, time = happenings$pulseseq)
  )

plot_crsim(testrun.df, pars) 
```
