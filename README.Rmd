---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "40%",
  dpi = 300
)
```

# rescomp

<!-- badges: start -->
<!-- badges: end -->

The goal of the R package `rescomp` is to simplify the process of defining, simulating and visualizing the output of ODE models of consumer-resource interactions. In essence, it is a consumer-resource modelling focused interface to the excellent `deSolve` package.

## Installation

You can install `rescomp` from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("andrewletten/rescomp")
```
## Example

```{r}
library(rescomp)
library(deSolve)
```

The main user function in `rescomp` is `make_par_list`, which facilitates i) the definition and parameterisation of a desired consumer-resource model, and ii) the specification of simulation parameters. The default output from `make_par_list` is a list defining a model for a single type I consumer (linear functional response) and a single logistically growing resource.

```{r}
pars <- make_par_list()
```

`rescomp::funcresp` plots the functional response for easy visualistion prior to running a simulation.

```{r, fig.width = 4, fig.height = 3}
plot_funcresp(pars)
```

<!-- `rescomp::time_vals` sets the simulation length (and other resource pulse frequency if required). The default simulation length is 1000. The function `initiate_state` sets the starting values of state variables defaulting to 10 for consumers and the resource supply concentration for resources.  -->

The model is then simulated via `rescomp::sim_rescomp` (a wrapper for `deSolve::ode` with convenient defaults).

```{r}
m1 <- sim_rescomp(pars)
```

Output dynamics can be visualised with `rescomp::plot_crsim`.

```{r, fig.width = 9, fig.height = 4.5, out.width = "70%"}
plot_crsim(m1, pars) 
```


The main utility of `rescomp` comes with specifying more elaborate models and simulation dynamics. Features/options include (but not limited to): 

- Number of consumers/resources
- Consumer functional response (type I or type II)
- Resource dynamic (chemostat, logistic and/or pulsed)
- Resource type (substitutable or essential)
- Continuous or intermittent mortality (e.g. serial transfer)
- Time dependent consumption parameters 


See `?make_par_list` for all argument options. 

The following two examples demonstrate how to build and simulate a model for: i) two consumers with type II functional responses on a single logistically growing resources; and ii) two consumers with type I functional responses with pulsed resources and time dependent consumptions parameters. A wide range of other examples can be found in the package vignette. 

### Example 1

```{r}
pars <- make_par_list(
  spnum = 2, 
  resnum = 1,
  linear = FALSE,
  mumatrix = list(matrix(c(0.7,0.05), 
                    nrow = 2, 
                    ncol = 1,
                    byrow = TRUE)),
  kmatrix = matrix(c(2, 0.015), 
                   nrow = 2, 
                   ncol = 1, 
                   byrow = TRUE),  
  resspeed = 3,
  resconc = 0.2,
  totaltime = 2000
)
```

```{r, fig.width = 4, fig.height = 3}
plot_funcresp(pars, maxx = 0.2)
```

```{r, fig.width = 9, fig.height = 4.5, out.width = "70%"}
m2 <- sim_rescomp(pars)
plot_crsim(m2, pars) 
```

### Example 2

```{r}
pars <- make_par_list(
  spnum = 2, 
  resnum = 2,
  linear = TRUE,
  timepars = TRUE,
  timeparfreq = 40,
  mumatrix = list(matrix(c(0.4,0.1,
                           0.05, 0.02), 
                    nrow = 2, 
                    ncol = 2,
                    byrow = TRUE),
                  matrix(c(0.2, 0.1,
                           0.5, 0.3), 
                    nrow = 2, 
                    ncol = 2,
                    byrow = TRUE)),
  resspeed = 0,
  resconc = 1,
  respulse = 1,
  pulsefreq = 40,
  totaltime = 1000
)
```

```{r, fig.width = 6, fig.height = 4, out.width = "60%"}
plot_funcresp(pars, maxx = 1)
```

```{r}
m3 <- sim_rescomp(pars)
```

```{r, fig.width = 9, fig.height = 4.5, out.width = "70%"}
plot_crsim(m3, pars) 
```

Disclaimer: As a biologist with no formal training in software development, I cannot vouch 100% that `rescomp` is bug free, maximally efficient or entirely consistent with 'tidy' principles. I have done my best but please use with caution!
